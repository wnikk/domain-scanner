# Domain Management Automation

This project contains two scripts for managing Nginx domains and configurations within the IndigoStack environment.
The project automates the discovery of domain directories and updates configuration files based on these findings.

## Files

1. **scan_domains.sh**: A shell script that scans directories for domain folders and subdomains and saves the results in a JSON file.
2. **update_domains.py**: A Python script that reads the generated domain JSON and updates the Nginx service configuration accordingly in IndigoStack.

## Requirements

- **Python 3.x** (for running `update_domains.py`)
- **Bash** (for running `scan_domains.sh`)
- Ensure `realpath` and `find` commands are available in your system (for `scan_domains.sh`).

## Usage

### 1. `scan_domains.sh` Script

This script scans directories to automatically detect domains and subdomains and saves the results in a `domains.json` file.
It also checks for special `.noautodomain` files, which allow for custom domain-folder mappings.


### 2. `update_domains.py` Script

This Python script reads the `domains.json` file generated by `scan_domains.sh`,
updates the Nginx configuration in IndigoStack, and creates the necessary site configuration files.

#### Running the Script

Run the following to update your Nginx domain configuration:

```bash
python3 update_domains.py
```

This will:
- Update the main IndigoStack configuration file (`config.json`).
- Write or update individual Nginx site configuration files in the `INDIGOSTACK_CONFIG_LIST_FOLDER`.
- Remove old site configurations that are no longer needed.

### Configuration

**Paths**: Ensure the `USER_HOME_FOLDER` variable in `update_domains.py` point to the correct paths on your system.
   
   For example:
   ```python
   USER_HOME_FOLDER = '/Users/admin/'
   AUTO_DOMAIN_ROOT = '/var/www/'
   ```

## Example Workflow

1. **Step 1**: Run the `scan_domains.sh` script to detect domains:
   ```bash
   ./scan_domains.sh
   ```

2. **Step 2**: Run the `update_domains.py` script to update the Nginx configuration:
   ```bash
   python3 update_domains.py
   ```

After these steps, your Nginx configuration will be updated based on the domain structure found in your file system.

## License

This project is licensed under the MIT License.
